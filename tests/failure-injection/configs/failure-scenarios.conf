# ArcDeploy Failure Injection Configuration
# This file defines failure scenarios, intensity levels, and test parameters

# ============================================================================
# Global Configuration
# ============================================================================

# Default test duration in seconds
DEFAULT_DURATION=60

# Default recovery timeout in seconds
RECOVERY_TIMEOUT=300

# Maximum concurrent failure injections
MAX_CONCURRENT_FAILURES=3

# Log level (DEBUG, INFO, WARNING, ERROR)
LOG_LEVEL=INFO

# Enable automatic recovery after test completion
AUTO_RECOVERY=true

# Test result directory
RESULTS_DIR="$PROJECT_ROOT/test-results/failure-injection"

# ============================================================================
# Network Failure Scenarios
# ============================================================================

[NETWORK_FAILURES]
# DNS failure scenarios
DNS_COMPLETE_DURATION=60
DNS_PARTIAL_DURATION=120
DNS_SLOW_DURATION=180

# Port blocking scenarios
PORT_BLOCKING_PORTS="8080,8443,2222"
PORT_BLOCKING_DURATION=90

# Bandwidth throttling
BANDWIDTH_THROTTLE_LIMIT="1mbit"
BANDWIDTH_THROTTLE_DURATION=120

# Network interface failures
INTERFACE_FAILURE_DURATION=60
INTERFACE_FLAPPING_CYCLES=5

# Packet loss configuration
PACKET_LOSS_PERCENTAGE=25
PACKET_LOSS_DURATION=90

# Network latency injection
LATENCY_DELAY="500ms"
LATENCY_JITTER="100ms"
LATENCY_DURATION=120

# Connection exhaustion
CONNECTION_EXHAUSTION_COUNT=1000
CONNECTION_EXHAUSTION_TARGET_PORT=8080

# ============================================================================
# Service Failure Scenarios
# ============================================================================

[SERVICE_FAILURES]
# Critical services to test
CRITICAL_SERVICES="blocklet-server,nginx,redis-server"
SECURITY_SERVICES="ssh,fail2ban,ufw"

# Service stop scenarios
SERVICE_STOP_DURATION=60
SERVICE_RESTART_DELAY=10

# Process kill scenarios
KILL_SIGNALS="TERM,KILL,USR1,USR2"
KILL_DURATION=90

# Configuration corruption
CONFIG_CORRUPTION_TYPES="syntax_error,permission_deny,empty_config,wrong_values"
CONFIG_BACKUP_ENABLED=true

# Resource exhaustion for services
MEMORY_EXHAUSTION_DURATION=120
CPU_EXHAUSTION_DURATION=180
DISK_EXHAUSTION_DURATION=90
FD_EXHAUSTION_DURATION=60

# Dependency failure testing
DEPENDENCY_FAILURE_DURATION=120
AUTO_DETECT_DEPENDENCIES=true

# Filesystem issues
PERMISSION_ISSUES_DURATION=90
DISK_FULL_PERCENTAGE=90
MISSING_FILES_DURATION=60

# ============================================================================
# System Resource Failure Scenarios
# ============================================================================

[SYSTEM_FAILURES]
# Memory scenarios
MEMORY_BOMB_INTENSITY="high"
MEMORY_BOMB_DURATION=90
MEMORY_LEAK_RATE=10
MEMORY_LEAK_DURATION=180

# Swap scenarios
SWAP_THRASHING_INTENSITY="medium"
SWAP_THRASHING_DURATION=120
SWAP_EMERGENCY_SIZE="1G"

# CPU scenarios
CPU_BOMB_CORES="auto"
CPU_BOMB_DURATION=60
CONTEXT_SWITCHING_PROCESSES=1000
CONTEXT_SWITCHING_DURATION=90

# CPU frequency scaling
CPU_FREQUENCY_MODES="powersave,performance,userspace"
CPU_FREQUENCY_DURATION=120

# Disk I/O scenarios
IO_STORM_INTENSITY="high"
IO_STORM_DURATION=120
IO_STORM_TARGET_DIR="/tmp"

# Disk space scenarios
DISK_FILL_PERCENTAGE=85
DISK_FILL_DURATION=90
DISK_FILL_TARGET_DIR="/tmp"

# Inode exhaustion
INODE_EXHAUSTION_PERCENTAGE=80
INODE_EXHAUSTION_DURATION=120

# ============================================================================
# Intensity Levels
# ============================================================================

[INTENSITY_LOW]
MEMORY_SIZE="512M"
CPU_PROCESSES=2
IO_OPERATIONS=2
NETWORK_LATENCY="100ms"
PACKET_LOSS=10

[INTENSITY_MEDIUM]
MEMORY_SIZE="1G"
CPU_PROCESSES=4
IO_OPERATIONS=4
NETWORK_LATENCY="250ms"
PACKET_LOSS=25

[INTENSITY_HIGH]
MEMORY_SIZE="2G"
CPU_PROCESSES=8
IO_OPERATIONS=8
NETWORK_LATENCY="500ms"
PACKET_LOSS=50

[INTENSITY_EXTREME]
MEMORY_SIZE="4G"
CPU_PROCESSES=16
IO_OPERATIONS=16
NETWORK_LATENCY="1000ms"
PACKET_LOSS=75

# ============================================================================
# Test Suites
# ============================================================================

[TEST_SUITE_BASIC]
NAME="Basic Failure Testing"
SCENARIOS="dns_partial,service_stop,memory_bomb"
DURATION=60
CONCURRENT=false

[TEST_SUITE_COMPREHENSIVE]
NAME="Comprehensive Failure Testing"
SCENARIOS="dns_complete,port_blocking,service_kill,config_corruption,memory_leak,cpu_bomb,io_storm"
DURATION=120
CONCURRENT=false
RECOVERY_BETWEEN_TESTS=true

[TEST_SUITE_STRESS]
NAME="Stress Testing"
SCENARIOS="memory_bomb,cpu_bomb,io_storm,swap_thrashing,connection_exhaustion"
DURATION=180
CONCURRENT=true
MAX_CONCURRENT=2

[TEST_SUITE_SECURITY]
NAME="Security Service Testing"
SCENARIOS="service_stop,config_corruption,permission_issues"
SERVICES="ssh,fail2ban,ufw"
DURATION=90
CONCURRENT=false

[TEST_SUITE_NETWORK]
NAME="Network Resilience Testing"
SCENARIOS="dns_complete,dns_slow,port_blocking,bandwidth_throttle,packet_loss,high_latency"
DURATION=90
CONCURRENT=false

[TEST_SUITE_RAPID]
NAME="Rapid Failure Testing"
SCENARIOS="service_stop,memory_bomb,cpu_bomb"
DURATION=30
CONCURRENT=true
QUICK_RECOVERY=true

# ============================================================================
# Recovery Configuration
# ============================================================================

[RECOVERY_SETTINGS]
# Enable automatic cleanup after each test
CLEANUP_ENABLED=true

# Recovery attempt timeout
RECOVERY_TIMEOUT=300

# Number of recovery retry attempts
RECOVERY_RETRIES=3

# Delay between recovery attempts
RECOVERY_RETRY_DELAY=10

# Services to always restart after testing
ALWAYS_RESTART_SERVICES="blocklet-server,nginx"

# Files to backup before corruption tests
BACKUP_FILES="/etc/systemd/system/blocklet-server.service,/etc/nginx/nginx.conf,/etc/redis/redis.conf,/etc/ssh/sshd_config"

# Temporary file cleanup patterns
CLEANUP_PATTERNS="/tmp/*_stress_*,/tmp/*_bomb_*,/tmp/*_exhaustion_*,/tmp/memory_fill_*"

# ============================================================================
# Monitoring and Alerting
# ============================================================================

[MONITORING]
# Enable system resource monitoring during tests
MONITOR_RESOURCES=true

# Monitoring interval in seconds
MONITOR_INTERVAL=5

# Resource thresholds for alerts
MEMORY_THRESHOLD_WARNING=85
MEMORY_THRESHOLD_CRITICAL=95
CPU_THRESHOLD_WARNING=80
CPU_THRESHOLD_CRITICAL=95
DISK_THRESHOLD_WARNING=85
DISK_THRESHOLD_CRITICAL=95

# Service health checks
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_INTERVAL=10
HEALTH_CHECK_ENDPOINTS="http://localhost:8080,http://localhost:6379"

# Alert on service failures
ALERT_ON_SERVICE_FAILURE=true
ALERT_ON_RESOURCE_THRESHOLD=true

# ============================================================================
# Safety and Limits
# ============================================================================

[SAFETY_LIMITS]
# Maximum test duration (failsafe)
MAX_TEST_DURATION=3600

# Minimum free memory to maintain (MB)
MIN_FREE_MEMORY=512

# Minimum free disk space to maintain (MB)
MIN_FREE_DISK=1024

# Maximum CPU usage to allow (%)
MAX_CPU_USAGE=95

# Emergency stop triggers
EMERGENCY_STOP_ON_OOM=true
EMERGENCY_STOP_ON_DISK_FULL=true
EMERGENCY_STOP_ON_SERVICE_CRASH=false

# Blacklisted scenarios (disable dangerous tests)
BLACKLISTED_SCENARIOS=""

# Protected services (never stop these)
PROTECTED_SERVICES="systemd,kernel,init"

# Protected files (never modify these)
PROTECTED_FILES="/etc/passwd,/etc/shadow,/etc/fstab,/boot/*"

# ============================================================================
# Reporting Configuration
# ============================================================================

[REPORTING]
# Generate detailed reports
DETAILED_REPORTS=true

# Report formats (txt, json, html)
REPORT_FORMATS="txt,json"

# Include system metrics in reports
INCLUDE_METRICS=true

# Include logs in reports
INCLUDE_LOGS=true

# Report retention days
REPORT_RETENTION_DAYS=30

# Email reporting (if configured)
EMAIL_REPORTS=false
EMAIL_RECIPIENTS=""

# ============================================================================
# Advanced Configuration
# ============================================================================

[ADVANCED]
# Enable experimental scenarios
EXPERIMENTAL_SCENARIOS=false

# Custom scenario directory
CUSTOM_SCENARIO_DIR=""

# Pre-test hooks
PRE_TEST_HOOKS=""

# Post-test hooks
POST_TEST_HOOKS=""

# Test isolation (containerized testing)
TEST_ISOLATION=false

# Parallel test execution
PARALLEL_EXECUTION=false
MAX_PARALLEL_TESTS=2

# Test randomization
RANDOMIZE_TEST_ORDER=false
RANDOM_SEED=""

# Debug mode
DEBUG_MODE=false
VERBOSE_LOGGING=false
KEEP_TEMP_FILES=false